pipeline {
     agent any
     stages {
        stage("Cache Cleaning") {
            steps {
              sh "sudo docker system prune --force --all --volumes"
              sh "sudo docker image prune"
              sh "sudo find /tmp -type f -atime +10 -delete"
              sh "sudo pwd"
            }
        }
        stage("Build") {
          steps {
            dir('./code/api') {
              sh "sudo docker build -t sallu-api ."
            }
          }
        }
        stage("Deploy") {
          steps {
            dir('./code/api') {
              sh "sudo docker run -p 80:8080 sallu-api & exit 0"
            }
          }
        }
    }
}